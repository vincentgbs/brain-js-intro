<html>
    <head>
        <!-- brain.js cdn -->
        <!-- <script src="https://cdn.rawgit.com/BrainJS/brain.js/45ce6ffc/browser.js"></script> -->
        <script src="https://unpkg.com/brain.js@1.6.0/browser.js"></script>
        <!-- script source -->
        <!-- <script src="js/intro.js"></script> -->
        <!-- <script src="js/objects.js"></script> -->
        <!-- <script src="js/eatfree.js"></script> -->
        <!-- <script src="js/count.js"></script> -->
        <script src="js/stocks.js"></script>
    </head>
    <body>
        <!-- https://scrimba.com/g/gneuralnetworks -->
        <div id="console"></div>
        <button id="train">Train</button>
        <button id="run">Run test</button>

        <script>
            // console.log(rawData[0]);
            function scaleDown(step) {
                return {
                    open: step.open  / 138,
                    high: step.high  / 138,
                    low: step.low  / 138,
                    close: step.close  / 138,
                };
            }
            // console.log(scaleDown(rawData[0]));

            // reverse of normalize stepDown
            function scaleUp(step) {
                return {
                    open: step.open * 138,
                    high: step.high * 138,
                    low: step.low * 138,
                    close: step.close * 138,
                };
            }
            // console.log(scaleUp(scaleDown(rawData[0])));
            const scaledData = rawData.map(scaleDown);

            // we want the neural net to recognize smaller patterns and predict off those
            const trainingData = [
                scaledData.slice(0, 5),
                scaledData.slice(5, 10),
                scaledData.slice(10, 15),
                scaledData.slice(15, 20)
            ];
            // console.log(trainingData);
            const net = new brain.recurrent.LSTMTimeStep({
                inputSize: 4,
                hiddenLayers: [8, 8],
                outputSize: 4,
            });

            document.getElementById("train").addEventListener("click", function() {
                net.train(trainingData, {
                    learningRate: 0.005,
                    errorThresh: 0.02,
                    log: (stats) => console.log(stats)});
            });

            document.getElementById("run").addEventListener("click", function() {
                console.log(scaleUp(net.run(trainingData[0])));
            });
        </script>
    </body>
</html>
